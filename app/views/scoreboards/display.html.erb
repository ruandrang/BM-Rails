<%# Scoreboard Display - Redesigned with Responsive Layout %>
<div id="scoreboard-root"
     class="w-full h-screen flex flex-col bg-[#0A0E1A] overflow-hidden select-none relative"
     data-scoreboard-root
     data-scoreboard-role="display"
     data-match-id="<%= @match.id %>"
     data-teams="<%= @match.teams.respond_to?(:map) ? @match.teams.map { |t| { id: t.id, label: t.respond_to?(:label) ? t.label : t.name, name: t.name, color: t.color, icon: t.respond_to?(:icon) ? t.icon : 'üèÄ', score: 0 } }.to_json : @match.teams.to_json %>"
     data-games="<%= @games_for_scoreboard.to_json %>"
     data-teams-count="<%= @match.teams.count %>"
     data-regular-quarters="<%= @match.respond_to?(:regular_quarters) ? @match.regular_quarters : 4 %>"
     data-default-period-seconds="<%= current_user.default_period_seconds %>"
     data-locale="<%= current_locale %>"
     data-voice-lang="<%= current_user.speech_locale %>"
     data-sound-enabled="<%= current_user.scoreboard_sound_enabled %>"
     data-voice-enabled="<%= current_user.voice_announcement_enabled %>"
     data-voice-rate="<%= current_user.voice_announcement_rate %>"
     data-possession-switch-pattern="<%= current_user.possession_switch_pattern %>">

  <%# Header Bar - Í∞ÑÏÜåÌôî (h-20) %>
  <header class="h-14 md:h-16 lg:h-20 bg-[#111827] flex items-center justify-between px-4 md:px-8 lg:px-12 border-b border-gray-700/50 shrink-0">
    <%# LIVE Indicator %>
    <div class="flex items-center space-x-2">
      <div class="w-3 h-3 md:w-4 md:h-4 lg:w-5 lg:h-5 rounded-full bg-red-500 animate-pulse"></div>
      <span class="text-red-500 font-bold tracking-wider text-sm md:text-lg lg:text-xl">LIVE</span>
    </div>

    <%# Quarter Badge (Ï§ëÏïô) %>
    <div class="absolute left-1/2 transform -translate-x-1/2">
      <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white font-black px-4 py-1.5 md:px-6 md:py-2 lg:px-8 lg:py-3 rounded-lg shadow-lg uppercase tracking-wider text-lg md:text-xl lg:text-2xl">
        <span data-scoreboard-quarter>1</span>Q
      </div>
    </div>

    <%# Size Controls & Fullscreen %>
    <div class="flex items-center space-x-2 md:space-x-3">
      <%# Text Size Controls %>
      <div class="hidden md:flex items-center space-x-1 bg-gray-800 rounded-lg px-2 py-1.5">
        <button id="size-decrease-btn" class="w-8 h-8 bg-gray-700 hover:bg-gray-600 text-white text-sm font-bold rounded transition-colors flex items-center justify-center" title="<%= t('scoreboard.size_decrease', default: 'Í∏ÄÏûê Ï∂ïÏÜå') %>">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4" /></svg>
        </button>
        <span class="text-gray-400 text-xs font-bold px-1" data-size-indicator>100%</span>
        <button id="size-increase-btn" class="w-8 h-8 bg-gray-700 hover:bg-gray-600 text-white text-sm font-bold rounded transition-colors flex items-center justify-center" title="<%= t('scoreboard.size_increase', default: 'Í∏ÄÏûê ÌôïÎåÄ') %>">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4" /></svg>
        </button>
      </div>
      <button id="fullscreen-btn" class="bg-blue-600 hover:bg-blue-700 text-white text-xs md:text-sm font-bold px-3 py-1.5 md:px-5 md:py-2 lg:px-6 lg:py-2.5 rounded-lg transition-colors uppercase tracking-wide shadow-lg">
        <span data-ui-key="fullscreen">Full</span>
      </button>
    </div>
  </header>

  <%# Main Content Area %>
  <div class="flex-1 relative flex flex-col min-h-0">

    <%# === Large/Medium: Í∞ÄÎ°ú 3-column / Small: ÏÑ∏Î°ú Ïä§ÌÉù === %>
    <div class="flex-1 flex items-center justify-center relative
                p-2 md:p-4 lg:p-8
                max-md:flex-col max-md:gap-2 max-md:justify-start max-md:pt-4">

      <%# === Small Ï†ÑÏö©: Clock + Possession ÏÉÅÎã® Î∞∞Ïπò === %>
      <div class="md:hidden w-full flex flex-col items-center gap-2 mb-2 order-first">
        <%# Game Clock %>
        <div class="text-white font-bold text-clock-sm tracking-tight leading-none tabular-nums text-center" data-scoreboard-timer><%= "%d:%02d" % [current_user.default_period_seconds / 60, current_user.default_period_seconds % 60] %></div>
        <%# Possession Indicator (ÏÜåÌòï) %>
        <div class="flex items-center space-x-3" data-possession-indicator>
          <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center transition-all duration-300 possession-arrow-left">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-500 rotate-180" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
          </div>
          <span class="text-gray-500 text-xs font-bold tracking-widest uppercase">POSS</span>
          <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center transition-all duration-300 possession-arrow-right">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-500" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
          </div>
        </div>
      </div>

      <%# Left Team %>
      <div class="flex-1 flex flex-col items-center justify-center relative
                  max-md:flex-row max-md:w-full max-md:gap-4 max-md:px-4 max-md:py-2">
        <%# Team Name with Color Bar %>
        <div class="flex flex-col items-center mb-1 md:mb-2
                    max-md:order-1">
          <div class="flex items-center space-x-2 md:space-x-3 mb-1">
            <div class="w-5 h-5 md:w-6 md:h-6 lg:w-8 lg:h-8 rounded-full team-color-indicator-left" style="background-color: #3b82f6;" data-team-color-left></div>
            <h2 class="text-white text-lg md:text-2xl lg:text-4xl xl:text-5xl font-bold tracking-wider uppercase" data-team-name-left>TEAM A</h2>
          </div>
          <div class="h-1 md:h-1.5 lg:h-2 w-full rounded-full team-color-bar-left" style="background-color: #3b82f6;" data-team-bar-left></div>
        </div>

        <%# Score %>
        <div class="font-black text-score tracking-wide tabular-nums text-orange-500
                    max-md:order-2 max-md:text-score-sm"
             data-score-left>0</div>

        <%# Fouls (Large/Medium) %>
        <div class="mt-2 md:mt-4 lg:mt-8 flex flex-col items-center space-y-2 md:space-y-3
                    max-md:order-3 max-md:mt-0">
          <div class="flex items-center space-x-2 md:space-x-3">
            <span class="text-gray-400 text-xs md:text-sm lg:text-xl font-bold tracking-widest uppercase" data-ui-key="foul">Fouls</span>
            <div class="flex space-x-1 md:space-x-1.5 lg:space-x-2" data-foul-indicators-left>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="0" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="1" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="2" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="3" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="4" data-foul-active="false"></div>
            </div>
          </div>
          <span class="text-red-500 font-bold text-lg md:text-2xl lg:text-4xl uppercase tracking-wider hidden" data-team-foul-badge-left>TEAM FOUL</span>
        </div>
      </div>

      <%# Center Section - Clock, Possession, Shot Clock (Medium/LargeÎßå) %>
      <div class="w-1/4 hidden md:flex flex-col items-center justify-center h-full space-y-4 lg:space-y-8">
        <%# Game Clock %>
        <div class="text-center">
          <span class="text-gray-400 text-sm lg:text-xl font-bold tracking-[0.15em] uppercase mb-2 lg:mb-4 block" data-ui-key="game_clock_label">Game Clock</span>
          <div class="text-white font-bold text-clock tracking-tight leading-none transition-all duration-500 tabular-nums text-center" data-scoreboard-timer><%= "%d:%02d" % [current_user.default_period_seconds / 60, current_user.default_period_seconds % 60] %></div>
        </div>

        <%# Possession Indicator %>
        <div class="flex items-center space-x-3 lg:space-x-6" data-possession-indicator>
          <div class="w-10 h-10 lg:w-16 lg:h-16 rounded-full bg-gray-700 flex items-center justify-center transition-all duration-300 possession-arrow-left">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 lg:w-10 lg:h-10 text-gray-500 rotate-180" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
          </div>
          <span class="text-gray-400 text-xs lg:text-lg font-bold tracking-widest uppercase"><%= t('settings.possession.title', default: 'Possession') %></span>
          <div class="w-10 h-10 lg:w-16 lg:h-16 rounded-full bg-gray-700 flex items-center justify-center transition-all duration-300 possession-arrow-right">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 lg:w-10 lg:h-10 text-gray-500" viewBox="0 0 24 24" fill="currentColor"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
          </div>
        </div>

        <%# Shot Clock %>
        <div class="flex flex-col items-center w-full">
          <span class="text-gray-400 text-sm lg:text-xl font-bold tracking-[0.15em] uppercase mb-2 lg:mb-6" data-ui-key="shot_clock_label">Shot Clock</span>
          <div class="border border-gray-700 bg-[#111827]/60 backdrop-blur-sm rounded-xl px-6 lg:px-16 py-3 lg:py-6 w-full max-w-[450px] flex justify-center">
            <span class="text-[#39FF14] font-bold text-[64px] md:text-[96px] lg:text-[128px] xl:text-[160px] tabular-nums leading-none" data-scoreboard-shot>24</span>
          </div>
        </div>
      </div>

      <%# Right Team %>
      <div class="flex-1 flex flex-col items-center justify-center relative
                  max-md:flex-row max-md:w-full max-md:gap-4 max-md:px-4 max-md:py-2">
        <%# Team Name with Color Bar %>
        <div class="flex flex-col items-center mb-1 md:mb-2
                    max-md:order-1">
          <div class="flex items-center space-x-2 md:space-x-3 mb-1">
            <div class="w-5 h-5 md:w-6 md:h-6 lg:w-8 lg:h-8 rounded-full team-color-indicator-right" style="background-color: #ef4444;" data-team-color-right></div>
            <h2 class="text-white text-lg md:text-2xl lg:text-4xl xl:text-5xl font-bold tracking-wider uppercase" data-team-name-right>TEAM B</h2>
          </div>
          <div class="h-1 md:h-1.5 lg:h-2 w-full rounded-full team-color-bar-right" style="background-color: #ef4444;" data-team-bar-right></div>
        </div>

        <%# Score %>
        <div class="font-black text-score tracking-wide tabular-nums text-orange-500
                    max-md:order-2 max-md:text-score-sm"
             data-score-right>0</div>

        <%# Fouls (Large/Medium) %>
        <div class="mt-2 md:mt-4 lg:mt-8 flex flex-col items-center space-y-2 md:space-y-3
                    max-md:order-3 max-md:mt-0">
          <div class="flex items-center space-x-2 md:space-x-3">
            <span class="text-gray-400 text-xs md:text-sm lg:text-xl font-bold tracking-widest uppercase" data-ui-key="foul">Fouls</span>
            <div class="flex space-x-1 md:space-x-1.5 lg:space-x-2" data-foul-indicators-right>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="0" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="1" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="2" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="3" data-foul-active="false"></div>
              <div class="w-4 h-4 md:w-5 md:h-5 lg:w-8 lg:h-8 rounded-full bg-gray-700 border-2 border-red-500 transition-all duration-300" data-foul-circle="4" data-foul-active="false"></div>
            </div>
          </div>
          <span class="text-red-500 font-bold text-lg md:text-2xl lg:text-4xl uppercase tracking-wider hidden" data-team-foul-badge-right>TEAM FOUL</span>
        </div>
      </div>

      <%# === Small Ï†ÑÏö©: Shot Clock ÌïòÎã® === %>
      <div class="md:hidden w-full flex justify-center py-2 order-last">
        <div class="border border-gray-700 bg-[#111827]/60 rounded-xl px-8 py-3 flex flex-col items-center">
          <span class="text-gray-500 text-[10px] font-bold tracking-widest uppercase mb-1">SHOT CLOCK</span>
          <span class="text-[#39FF14] font-bold text-[51px] tabular-nums leading-none" data-scoreboard-shot>24</span>
        </div>
      </div>
    </div>

    <%# Sponsor Banner Area %>
    <div class="hidden md:block h-auto bg-[#111827] border-t border-gray-700/50 py-3 lg:py-6 px-4 lg:px-12 shrink-0" data-sponsor-area>
      <div class="flex gap-3 lg:gap-8 justify-center overflow-x-auto">
        <div class="bg-white rounded-lg lg:rounded-xl p-3 lg:p-6 flex items-center justify-center shadow-lg w-48 h-16 lg:w-72 lg:h-28 flex-shrink-0">
          <img src="/manpo.png?v=<%= Time.now.to_i %>" alt="ÎßåÌè¨Î©¥Ïò•" class="h-12 lg:h-20 object-contain">
        </div>
        <div class="bg-white rounded-lg lg:rounded-xl p-3 lg:p-6 flex items-center justify-center shadow-lg w-48 h-16 lg:w-72 lg:h-28 flex-shrink-0">
          <img src="/hongkong.png?v=<%= Time.now.to_i %>" alt="ÌôçÏΩ©Î∞òÏ†ê" class="h-12 lg:h-20 object-contain">
        </div>
        <div class="bg-white rounded-lg lg:rounded-xl p-3 lg:p-6 flex items-center justify-center shadow-lg w-48 h-16 lg:w-72 lg:h-28 flex-shrink-0">
          <img src="/mapo-YC.png?v=<%= Time.now.to_i %>" alt="ÏãúÎ¶ΩÎßàÌè¨Ï≤≠ÏÜåÎÖÑÏÑºÌÑ∞" class="h-12 lg:h-20 object-contain">
        </div>
        <div class="bg-white rounded-lg lg:rounded-xl p-3 lg:p-6 flex items-center justify-center shadow-lg w-48 h-16 lg:w-72 lg:h-28 flex-shrink-0">
          <img src="/b-paper.png?v=<%= Time.now.to_i %>" alt="B.PAPER" class="h-12 lg:h-20 object-contain">
        </div>
        <div class="bg-white rounded-lg lg:rounded-xl p-3 lg:p-6 flex items-center justify-center shadow-lg w-48 h-16 lg:w-72 lg:h-28 flex-shrink-0">
          <img src="/daeroo.png?v=<%= Time.now.to_i %>" alt="DAEROO COFFEE" class="h-12 lg:h-20 object-contain">
        </div>
      </div>
    </div>
  </div>

  <%# Ïó∞Í≤∞ ÎÅäÍπÄ Ïò§Î≤ÑÎ†àÏù¥ %>
  <div class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden" data-connection-overlay>
    <div class="text-center">
      <div class="text-red-500 text-6xl mb-4 animate-pulse">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
        </svg>
      </div>
      <div class="text-white text-2xl md:text-3xl font-bold" data-ui-key="connection_lost"><%= t('scoreboard.connection_lost', default: 'Ïó∞Í≤∞ ÎÅäÍπÄ') %></div>
      <div class="text-gray-400 text-lg md:text-xl mt-2" data-ui-key="reconnecting"><%= t('scoreboard.reconnecting', default: 'Ïû¨Ïó∞Í≤∞ Ï§ë...') %></div>
    </div>
  </div>

</div>

<style>
  /* === CSS Î≥ÄÏàò === */
  :root {
    --display-scale: 1;
    --team-left-color: #FF6B00;
    --team-right-color: #FF6B00;
  }

  /* === Ïä§ÏΩîÏñ¥Î≥¥Îìú ÌÖçÏä§Ìä∏ Ïä§ÌÉÄÏùº (Large: 1280px+) === */
  .text-score {
    font-size: calc(clamp(10rem, 22vw, 18rem) * var(--display-scale));
    line-height: 1;
  }

  .text-clock {
    font-size: calc(clamp(6rem, 12vw, 10rem) * var(--display-scale));
    line-height: 1;
  }

  [data-scoreboard-shot] {
    font-size: calc(clamp(6.4rem, 14.4vw, 11.2rem) * var(--display-scale)) !important;
  }

  /* === Medium (768px ~ 1279px) === */
  @media (min-width: 768px) and (max-width: 1279px) {
    .text-score {
      font-size: calc(clamp(6rem, 14vw, 10rem) * var(--display-scale));
    }
    .text-clock {
      font-size: calc(clamp(4rem, 8vw, 7rem) * var(--display-scale));
    }
  }

  /* === Small (<768px) - ÏÑ∏Î°ú Î™®Îìú === */
  .text-score-sm {
    font-size: calc(clamp(4rem, 18vw, 6rem) * var(--display-scale)) !important;
    line-height: 1;
  }

  .text-clock-sm {
    font-size: calc(clamp(3rem, 12vw, 5rem) * var(--display-scale));
    line-height: 1;
  }

  @media (max-width: 767px) {
    [data-scoreboard-shot] {
      font-size: calc(clamp(2.4rem, 11.2vw, 4rem) * var(--display-scale)) !important;
    }
  }

  /* === Possession arrows === */
  .possession-arrow-left,
  .possession-arrow-right {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    background-color: #374151;
    transition: all 0.3s ease;
  }

  .possession-arrow-left svg,
  .possession-arrow-right svg {
    color: #6B7280;
    transition: color 0.3s ease;
  }

  .possession-arrow-left.active,
  .possession-arrow-right.active {
    background-color: #ef4444 !important;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
  }

  .possession-arrow-left.active svg,
  .possession-arrow-right.active svg {
    color: white !important;
  }

  /* === ÌååÏö∏ Ïõê ÌôúÏÑ±Ìôî === */
  [data-foul-active="true"] {
    background-color: #EF4444 !important;
    border-color: #EF4444 !important;
    box-shadow: 0 0 12px rgba(239, 68, 68, 0.6);
    transform: scale(1.15);
  }


  /* === Team foul badge animation === */
  [data-team-foul-badge-left]:not(.hidden),
  [data-team-foul-badge-right]:not(.hidden) {
    animation: foul-pulse 1s ease-in-out infinite;
  }

  @keyframes foul-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  [data-scoreboard-timer]:not(.timer-running) {
    opacity: 0.75;
    transition: opacity 0.5s ease;
  }
</style>
