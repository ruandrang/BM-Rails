<%# External Sports Scoreboard Display %>
<div id="scoreboard-root"
     class="w-full h-screen flex flex-col bg-[#0a0a0a] overflow-hidden select-none relative"
     data-scoreboard-root 
     data-scoreboard-role="display"
     data-match-id="<%= @match.id %>"
     data-teams="<%= @match.teams.to_json %>"
     data-teams-count="<%= @match.teams.count %>">

  <%# Top Bar - Team Names and Timer %>
  <div class="h-[18%] bg-gradient-to-b from-[#1a1a1a] to-[#0f0f0f] border-b-4 border-[#333] flex items-center justify-between px-12 relative">
    <%# Left Team Name %>
    <div class="flex-1 flex justify-start">
      <div class="px-8 py-3 rounded-lg shadow-lg team-badge-left" style="background-color: #1e40af; border: 2px solid #3b82f6;">
        <span class="text-white font-bold text-4xl tracking-wider font-['Inter']" data-team-name-left>TEAM A</span>
      </div>
    </div>

    <%# Center Timer %>
    <div class="flex flex-col items-center gap-2">
      <span class="text-[#00ff00] font-['DSEG7'] font-bold tracking-wider tabular-nums" 
            style="font-size: 10rem;"
            data-scoreboard-timer>10:00</span>
      <span class="text-gray-500 text-sm tracking-widest uppercase">Game Clock</span>
    </div>

    <%# Right Team Name %>
    <div class="flex-1 flex justify-end">
      <div class="px-8 py-3 rounded-lg shadow-lg team-badge-right" style="background-color: #dc2626; border: 2px solid #ef4444;">
        <span class="text-white font-bold text-4xl tracking-wider font-['Inter']" data-team-name-right>TEAM B</span>
      </div>
    </div>
  </div>

  <%# Center Score Area %>
  <div class="flex-1 flex items-center justify-center px-12 relative">
    <%# Left Score %>
    <div class="flex flex-col items-center gap-4 flex-1 justify-center">
      <span class="text-[#ffa500] font-['DSEG7'] font-bold tabular-nums leading-none" 
            style="font-size: 26.4rem;"
            data-score-left>0</span>
      <div class="px-6 py-2 bg-[#1a1a1a] border border-[#333] rounded flex items-center gap-3">
        <span class="text-gray-400 text-xs tracking-wider uppercase">FOUL</span>
        <div class="flex gap-2" data-foul-indicators-left>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="0"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="1"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="2"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="3"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="4"></div>
        </div>
      </div>
      <div class="hidden mt-2" data-left-team-foul-indicator>
        <span class="text-red-500 font-bold text-lg tracking-widest uppercase animate-pulse">TEAM FOUL</span>
      </div>
    </div>

    <%# Center Info - Quarter and Possession - FIXED POSITION %>
    <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-8" style="width: 400px;">
      <%# Possession Arrow %>
      <div class="h-16 flex justify-center" data-possession-indicator>
        <svg width="80" height="64" viewBox="0 0 80 64" class="possession-arrow-left hidden">
          <polygon points="80,32 20,0 20,24 0,24 0,40 20,40 20,64" fill="#ff0000" />
        </svg>
        <svg width="80" height="64" viewBox="0 0 80 64" class="possession-arrow-right hidden">
          <polygon points="0,32 60,0 60,24 80,24 80,40 60,40 60,64" fill="#ff0000" />
        </svg>
      </div>

      <%# Quarter Badge %>
      <div class="px-12 py-4 bg-white border-4 border-[#666] rounded-xl shadow-2xl">
        <span class="text-black font-['DSEG7'] text-6xl font-bold" data-scoreboard-quarter>1</span>
      </div>

      <%# Shot Clock %>
      <div class="flex flex-col items-center gap-1">
        <span class="text-[#00ff00] font-['DSEG7'] font-bold tabular-nums" 
              style="font-size: 10rem;"
              data-scoreboard-shot>24</span>
        <span class="text-gray-500 text-xs tracking-widest uppercase">Shot Clock</span>
      </div>
    </div>

    <%# Right Score %>
    <div class="flex flex-col items-center gap-4 flex-1 justify-center">
      <span class="text-[#ffa500] font-['DSEG7'] font-bold tabular-nums leading-none" 
            style="font-size: 26.4rem;"
            data-score-right>0</span>
      <div class="px-6 py-2 bg-[#1a1a1a] border border-[#333] rounded flex items-center gap-3">
        <span class="text-gray-400 text-xs tracking-wider uppercase">FOUL</span>
        <div class="flex gap-2" data-foul-indicators-right>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="0"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="1"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="2"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="3"></div>
          <div class="w-8 h-8 rounded-full" style="background-color: #1a1a1a; border: 2px solid #dc2626" data-foul-circle="4"></div>
        </div>
      </div>
      <div class="hidden mt-2" data-right-team-foul-indicator>
        <span class="text-red-500 font-bold text-lg tracking-widest uppercase animate-pulse">TEAM FOUL</span>
      </div>
    </div>
  </div>

  <%# Bottom Bar - Info and Fullscreen %>
  <div class="h-[12%] bg-gradient-to-t from-[#1a1a1a] to-[#0f0f0f] border-t-4 border-[#333] flex items-center justify-between px-12">
    <%# League Info %>
    <div class="flex flex-col">
      <span class="text-[#666] text-xs tracking-[3px] uppercase">BM League</span>
      <span class="text-gray-400 text-sm font-['JetBrains_Mono']"><%= @match.date.strftime("%Y.%m.%d") %> â€” Game <%= @match.id %></span>
    </div>

    <%# Fullscreen Button %>
    <button id="fullscreen-btn" 
            class="px-6 py-3 bg-[#1a1a1a] hover:bg-[#2a2a2a] border border-[#444] hover:border-[#666] rounded-lg transition-all duration-200 flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-400">
        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
      </svg>
      <span class="text-gray-400 text-sm font-bold tracking-wider uppercase">Fullscreen</span>
    </button>
  </div>

</div>

<style>
  /* 7-Segment LED Font */
  @font-face {
    font-family: 'DSEG7';
    src: url('/fonts/7-segment-trackmania-united.otf') format('opentype');
    font-weight: normal;
    font-style: normal;
  }

  /* Possession Arrow Animation */
  .possession-arrow-left,
  .possession-arrow-right {
    animation: pulse 1s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  /* Smooth transitions */
  [data-score-left], [data-score-right] {
    transition: all 0.3s ease;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    
    if (fullscreenBtn) {
      fullscreenBtn.addEventListener('click', () => {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen();
        } else {
          document.exitFullscreen();
        }
      });
    }
    
    // Apply team colors to badges
    const applyTeamColors = () => {
      const scoreboardRoot = document.querySelector('[data-scoreboard-root]');
      if (!scoreboardRoot) return;
      
      const teamsData = scoreboardRoot.dataset.teams;
      if (!teamsData) return;
      
      try {
        const teams = JSON.parse(teamsData);
        if (teams.length >= 2) {
          // For display page, swap team colors (teams[1] -> left, teams[0] -> right)
          const teamLeft = teams[1];  // Away team on left
          const teamRight = teams[0]; // Home team on right
          
          const badgeLeft = document.querySelector('.team-badge-left');
          const badgeRight = document.querySelector('.team-badge-right');
          
          if (badgeLeft && teamLeft.color) {
            badgeLeft.style.backgroundColor = teamLeft.color;
            badgeLeft.style.borderColor = teamLeft.color;
          }
          
          if (badgeRight && teamRight.color) {
            badgeRight.style.backgroundColor = teamRight.color;
            badgeRight.style.borderColor = teamRight.color;
          }
        }
      } catch(e) {
        console.error('Failed to parse team colors:', e);
      }
    };
    
    // Apply on load
    applyTeamColors();
    
    // Reapply when data updates (via ActionCable)
    document.addEventListener('scoreboard:updated', applyTeamColors);
  });
</script>
