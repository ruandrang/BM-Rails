<div class="min-h-screen bg-[#f3f4f6] text-[#111827] font-sans antialiased selection:bg-[#FF6B35]/20"
     data-scoreboard-root
     data-scoreboard-role="control"
     data-match-id="<%= @match.id %>"
     data-teams="<%= @teams_json %>"
     data-games="<%= @games_for_scoreboard.to_json %>"
     data-teams-count="<%= @match.teams.count %>"
     data-regular-quarters="<%= @match.respond_to?(:regular_quarters) ? @match.regular_quarters : 4 %>"
     data-default-period-seconds="<%= current_user.default_period_seconds %>"
     data-locale="<%= current_locale %>"
     data-voice-lang="<%= current_user.speech_locale %>"
     data-sound-enabled="<%= current_user.scoreboard_sound_enabled %>"
     data-voice-enabled="<%= current_user.voice_announcement_enabled %>"
     data-voice-rate="<%= current_user.voice_announcement_rate %>"
     data-possession-switch-pattern="<%= current_user.possession_switch_pattern %>">

  <div class="flex flex-col min-h-screen">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm">
      <div class="max-w-[1600px] mx-auto flex items-center justify-between">
        <div class="flex items-center gap-5">
          <div class="flex items-center justify-center size-12 rounded-xl bg-gradient-to-br from-[#FF6B35] to-[#E55A2B] text-white shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-7" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-black tracking-tight text-gray-900 leading-none">
              SCOREBOARD
            </h1>
            <div class="flex items-center gap-2 mt-1">
              <span class="relative flex h-2.5 w-2.5">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
              </span>
              <span class="text-xs font-bold text-green-600 uppercase tracking-widest" data-ui-key="control_connected">Connected</span>
            </div>
          </div>
        </div>

        <!-- Center: Club Name -->
        <div class="absolute left-1/2 -translate-x-1/2 text-center hidden md:block">
          <h2 class="text-lg font-bold text-gray-700" data-club-title data-club-name="<%= @club&.name.to_s %>"><%= @club&.name || "Standalone Mode" %></h2>
          <p class="text-xs text-gray-400 font-mono"><%= @match.played_on&.strftime("%Y.%m.%d") || Time.current.strftime("%Y.%m.%d") %></p>
        </div>

        <div class="flex items-center gap-3">
          <% if @match.id.to_s.start_with?("standalone_") %>
            <%= link_to standalone_display_path, target: "_blank", class: "group flex items-center gap-2 px-4 py-2.5 text-sm font-bold rounded-lg bg-blue-500 hover:bg-blue-600 text-white shadow-md shadow-blue-500/25 hover:shadow-lg hover:shadow-blue-500/30 transition-all", data: { ui_key: "open_display" } do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM4 6h5v2H4V6zm0 4h5v2H4v-2zm0 4h5v2H4v-2zm12 0h4v2h-4v-2zm0-4h4v2h-4v-2zm-6 0h5v6h-5v-6z"/>
              </svg>
              <span data-ui-key="open_display">디스플레이 열기</span>
            <% end %>
          <% else %>
            <%= link_to scoreboard_display_club_match_path(@club, @match), target: "_blank", class: "group flex items-center gap-2 px-4 py-2.5 text-sm font-bold rounded-lg bg-blue-500 hover:bg-blue-600 text-white shadow-md shadow-blue-500/25 hover:shadow-lg hover:shadow-blue-500/30 transition-all", data: { ui_key: "open_display" } do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zM4 6h5v2H4V6zm0 4h5v2H4v-2zm0 4h5v2H4v-2zm12 0h4v2h-4v-2zm0-4h4v2h-4v-2zm-6 0h5v6h-5v-6z"/>
              </svg>
              <span data-ui-key="open_display">디스플레이 열기</span>
            <% end %>
          <% end %>
          <button class="group flex items-center gap-2 px-4 py-2.5 text-sm font-semibold rounded-lg bg-gray-50 border border-gray-200 hover:bg-gray-100 transition-all text-gray-700"
                  data-action="toggle-quarter-score-reset"
                  data-ui-key="quarter_reset_off">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"/>
            </svg>
            <%= t('scoreboards.control.quarter_reset_off') %>
          </button>
          <div class="flex items-center gap-2 px-4 py-2 rounded-lg bg-red-50 border border-red-200">
            <span class="relative flex h-2 w-2">
              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-500 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2 w-2 bg-red-500"></span>
            </span>
            <span class="text-xs font-bold text-red-600 uppercase tracking-widest" data-ui-key="live">LIVE</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-[1600px] mx-auto w-full p-6 space-y-6">
      <!-- Timer & Shot Clock Row -->
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Game Timer -->
        <div class="lg:col-span-6 bg-white rounded-2xl p-8 shadow-[0_10px_15px_-3px_rgba(0,0,0,0.05),0_4px_6px_-2px_rgba(0,0,0,0.025)] border border-gray-100 flex flex-col justify-between relative overflow-hidden group">
          <div class="absolute top-0 right-0 p-32 bg-gray-50 rounded-full blur-3xl opacity-50 -mr-16 -mt-16 pointer-events-none group-hover:opacity-70 transition-opacity"></div>
          <div class="flex justify-between items-center z-10">
            <div class="flex items-center gap-3">
              <span class="quarter-badge-mockup" data-scoreboard-quarter>1Q</span>
              <span class="text-sm font-medium text-gray-400 uppercase tracking-wide" data-ui-key="game_timer"><%= t('scoreboards.control.game_timer') %></span>
            </div>
          </div>
          <div class="flex flex-col items-center justify-center py-6 z-10">
            <div class="text-[140px] leading-[0.8] font-bold tracking-tighter text-gray-900"
                 style="font-variant-numeric: tabular-nums; letter-spacing: -0.02em;"
                 id="control-game-clock"
                 data-scoreboard-timer>
              10:00
            </div>
          </div>
          <div class="grid grid-cols-4 gap-4 z-10">
            <button class="timer-btn-gray" data-action="minus-minute">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13H5v-2h14v2z"/></svg>
              <%= t('scoreboards.control.one_minute') %>
            </button>
            <button class="timer-btn-gray" data-action="plus-minute">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
              <%= t('scoreboards.control.one_minute') %>
            </button>
            <button class="timer-btn-green"
                    data-action="toggle-main"
                    data-start-text="<%= t('scoreboards.control.start') %>"
                    data-stop-text="<%= t('scoreboards.control.stop') %>">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
              <span data-ui-key="main_start"><%= t('scoreboards.control.start') %></span>
            </button>
            <button class="timer-btn-black" data-action="reset-main">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
              <span data-ui-key="reset">리셋</span>
            </button>
          </div>
        </div>

        <!-- Shot Clock -->
        <div class="lg:col-span-6 bg-white rounded-2xl p-8 shadow-[0_10px_15px_-3px_rgba(0,0,0,0.05),0_4px_6px_-2px_rgba(0,0,0,0.025)] border border-gray-100 flex flex-col relative overflow-hidden">
          <div class="absolute inset-0 bg-orange-50 opacity-50 pointer-events-none"></div>
          <div class="flex justify-between items-center mb-2 z-10">
            <span class="text-sm font-bold text-[#FF6B35] uppercase tracking-widest" data-ui-key="shot_clock_title">샷클락</span>
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-[#FF6B35]/50" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
            </svg>
          </div>
          <div class="flex-grow flex items-center justify-center z-10">
            <div class="text-[120px] leading-none font-black tracking-tighter text-[#FF6B35]"
                 style="font-variant-numeric: tabular-nums; letter-spacing: -0.02em;"
                 id="control-shot-clock"
                 data-scoreboard-shot>24</div>
          </div>
          <div class="grid grid-cols-3 gap-3 z-10 mt-6">
            <button class="shot-btn-outline" data-action="reset-shot-24"><%= t('scoreboards.control.shot_24') %></button>
            <button class="shot-btn-outline" data-action="reset-shot-14"><%= t('scoreboards.control.shot_14') %></button>
            <button class="shot-btn-solid flex items-center justify-center" data-action="toggle-shot">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Team Score Cards with Center Possession -->
      <div class="grid grid-cols-1 lg:grid-cols-[1fr_140px_1fr] gap-4 lg:gap-4 items-stretch">
        <!-- Home Team -->
        <div class="bg-white rounded-2xl shadow-[0_10px_15px_-3px_rgba(0,0,0,0.05),0_4px_6px_-2px_rgba(0,0,0,0.025)] border border-gray-100 overflow-hidden" data-team-color="<%= @match.home_team.color&.downcase || 'white' %>">
          <div class="team-header-<%= @match.home_team.color&.downcase || 'white' %> p-5 flex justify-between items-center" data-home-header>
            <div class="flex items-center gap-3">
              <div class="size-10 bg-white/20 backdrop-blur rounded-lg flex items-center justify-center shadow-md border border-white/30">
                <span class="font-black text-xl" data-home-icon><%= @match.home_team.name[0] %></span>
              </div>
              <h2 class="text-2xl font-bold tracking-tight" data-home-name><%= @match.home_team.name.upcase %></h2>
              <span class="hidden px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider animate-pulse" data-home-team-foul-badge>TEAM FOUL</span>
            </div>
            <div class="flex items-center gap-3 bg-black/10 px-4 py-2 rounded-xl">
              <span class="text-sm font-bold uppercase opacity-80" data-ui-key="foul">파울</span>
              <div class="h-6 w-px bg-current opacity-30"></div>
              <button class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/40 transition-colors text-lg font-bold" data-action="decrement-home-fouls">-</button>
              <span class="text-3xl font-black min-w-[2ch] text-center tabular-nums" data-home-fouls>0</span>
              <button class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/40 transition-colors text-lg font-bold" data-action="increment-home-fouls">+</button>
            </div>
          </div>
          <div class="p-6">
            <div class="flex items-end justify-between mb-6">
              <input type="number"
                     min="0"
                     step="1"
                     inputmode="numeric"
                     value="0"
                     id="control-home-score"
                     data-home-score
                     data-home-score-input
                     class="text-[100px] leading-[0.85] font-black text-gray-900 tracking-tighter bg-transparent border-none outline-none min-w-[3ch] w-auto max-w-[5ch] [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                     style="font-variant-numeric: tabular-nums; letter-spacing: -0.02em;" />
              <div class="grid grid-cols-3 gap-3 mb-2">
                <button class="score-btn-mockup" data-action="add-home-1">+1</button>
                <button class="score-btn-mockup" data-action="add-home-2">+2</button>
                <button class="score-btn-mockup" data-action="add-home-3">+3</button>
              </div>
            </div>
            <div class="flex gap-3 pt-4 border-t border-gray-100">
              <button class="flex-1 py-2.5 px-3 rounded-lg bg-gray-50 text-gray-600 font-semibold hover:bg-gray-100 transition-colors text-sm uppercase tracking-wide" data-action="sub-home">
                <%= t('scoreboards.control.minus_one') %>
              </button>
              <button class="flex-1 py-2.5 px-3 rounded-lg bg-gray-50 text-gray-600 font-semibold hover:bg-gray-100 transition-colors text-sm uppercase tracking-wide" data-action="reset-home-score">
                <span data-ui-key="reset"><%= t('scoreboards.control.score_reset') %></span>
              </button>
            </div>
            <%# 타임아웃 %>
            <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-100">
              <div class="flex items-center gap-2">
                <span class="text-sm font-bold text-gray-500 uppercase tracking-wide" data-ui-key="timeout_label"><%= t('scoreboards.control.timeout', default: 'T/O') %></span>
                <div class="flex gap-1.5" data-timeout-indicators-home>
                  <div class="w-6 h-6 rounded border-2 border-yellow-400 flex items-center justify-center text-xs font-bold" data-timeout data-timeout-active="false">
                    <span class="text-gray-300">-</span>
                  </div>
                  <div class="w-6 h-6 rounded border-2 border-yellow-400 flex items-center justify-center text-xs font-bold" data-timeout data-timeout-active="false">
                    <span class="text-gray-300">-</span>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <button class="px-3 py-1.5 rounded-lg bg-yellow-50 text-yellow-700 border border-yellow-200 hover:bg-yellow-100 transition-colors text-sm font-bold" data-action="home-timeout">
                  + T/O
                </button>
                <button class="px-3 py-1.5 rounded-lg bg-gray-50 text-gray-500 border border-gray-200 hover:bg-gray-100 transition-colors text-sm font-bold" data-action="reset-home-timeouts">
                  <%= t('scoreboards.control.score_reset', default: 'Reset') %>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Center: Possession & Swap (데스크톱만) -->
        <div class="hidden lg:flex flex-col items-center justify-center gap-3 py-4">
          <!-- 공격 방향 라벨 -->
          <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest"><%= t('scoreboards.control.possession_direction') %></span>

          <!-- 공격 방향 화살표 (크게) -->
          <div class="w-full h-16 flex items-center justify-center bg-gray-50 rounded-xl border border-gray-100">
            <svg width="56" height="28" viewBox="0 0 24 12" class="possession-arrow-left hidden fill-red-500">
              <polygon points="0,6 16,0 16,4 24,4 24,8 16,8 16,12" />
            </svg>
            <svg width="56" height="28" viewBox="0 0 24 12" class="possession-arrow-right hidden fill-blue-500">
              <polygon points="24,6 8,0 8,4 0,4 0,8 8,8 8,12" />
            </svg>
          </div>

          <!-- 공격 전환 버튼 -->
          <button class="w-full h-11 rounded-xl flex items-center justify-center gap-2 bg-teal-500 hover:bg-teal-600 text-white transition-colors font-bold text-sm shadow-md"
                  data-action="toggle-possession"
                  data-possession-toggle-btn
                  data-ui-key="toggle_possession">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/>
            </svg>
            <%= t('scoreboards.control.toggle_possession') %>
          </button>

          <!-- 점수 바꾸기 버튼 -->
          <button class="w-full h-11 rounded-xl flex items-center justify-center gap-2 bg-purple-50 hover:bg-purple-100 text-purple-600 border border-purple-200 transition-colors font-bold text-sm group"
                  data-action="swap-sides" data-ui-key="swap_scores" title="<%= t('scoreboards.control.swap_scores') %>">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5 group-hover:rotate-180 transition-transform duration-300" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/>
            </svg>
            <%= t('scoreboards.control.swap_scores') %>
          </button>
        </div>

        <!-- Away Team -->
        <div class="bg-white rounded-2xl shadow-[0_10px_15px_-3px_rgba(0,0,0,0.05),0_4px_6px_-2px_rgba(0,0,0,0.025)] border border-gray-100 overflow-hidden" data-team-color="<%= @match.away_team.color&.downcase || 'black' %>">
          <div class="team-header-<%= @match.away_team.color&.downcase || 'black' %> p-5 flex justify-between items-center" data-away-header>
            <div class="flex items-center gap-3">
              <div class="size-10 bg-white/20 backdrop-blur rounded-lg flex items-center justify-center shadow-md border border-white/30">
                <span class="font-black text-xl" data-away-icon><%= @match.away_team.name[0] %></span>
              </div>
              <h2 class="text-2xl font-bold tracking-tight" data-away-name><%= @match.away_team.name.upcase %></h2>
              <span class="hidden px-3 py-1 rounded-lg text-xs font-black uppercase tracking-wider animate-pulse" data-away-team-foul-badge>TEAM FOUL</span>
            </div>
            <div class="flex items-center gap-3 bg-black/10 px-4 py-2 rounded-xl">
              <span class="text-sm font-bold uppercase opacity-80" data-ui-key="foul">파울</span>
              <div class="h-6 w-px bg-current opacity-30"></div>
              <button class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/40 transition-colors text-lg font-bold" data-action="decrement-away-fouls">-</button>
              <span class="text-3xl font-black min-w-[2ch] text-center tabular-nums" data-away-fouls>0</span>
              <button class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/20 hover:bg-white/40 transition-colors text-lg font-bold" data-action="increment-away-fouls">+</button>
            </div>
          </div>
          <div class="p-6">
            <div class="flex items-end justify-between mb-6">
              <input type="number"
                     min="0"
                     step="1"
                     inputmode="numeric"
                     value="0"
                     id="control-away-score"
                     data-away-score
                     data-away-score-input
                     class="text-[100px] leading-[0.85] font-black text-gray-900 tracking-tighter bg-transparent border-none outline-none min-w-[3ch] w-auto max-w-[5ch] [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                     style="font-variant-numeric: tabular-nums; letter-spacing: -0.02em;" />
              <div class="grid grid-cols-3 gap-3 mb-2">
                <button class="score-btn-mockup" data-action="add-away-1">+1</button>
                <button class="score-btn-mockup" data-action="add-away-2">+2</button>
                <button class="score-btn-mockup" data-action="add-away-3">+3</button>
              </div>
            </div>
            <div class="flex gap-3 pt-4 border-t border-gray-100">
              <button class="flex-1 py-2.5 px-3 rounded-lg bg-gray-50 text-gray-600 font-semibold hover:bg-gray-100 transition-colors text-sm uppercase tracking-wide" data-action="sub-away">
                <%= t('scoreboards.control.minus_one') %>
              </button>
              <button class="flex-1 py-2.5 px-3 rounded-lg bg-gray-50 text-gray-600 font-semibold hover:bg-gray-100 transition-colors text-sm uppercase tracking-wide" data-action="reset-away-score">
                <span data-ui-key="reset"><%= t('scoreboards.control.score_reset') %></span>
              </button>
            </div>
            <%# 타임아웃 %>
            <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-100">
              <div class="flex items-center gap-2">
                <span class="text-sm font-bold text-gray-500 uppercase tracking-wide" data-ui-key="timeout_label"><%= t('scoreboards.control.timeout', default: 'T/O') %></span>
                <div class="flex gap-1.5" data-timeout-indicators-away>
                  <div class="w-6 h-6 rounded border-2 border-yellow-400 flex items-center justify-center text-xs font-bold" data-timeout data-timeout-active="false">
                    <span class="text-gray-300">-</span>
                  </div>
                  <div class="w-6 h-6 rounded border-2 border-yellow-400 flex items-center justify-center text-xs font-bold" data-timeout data-timeout-active="false">
                    <span class="text-gray-300">-</span>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <button class="px-3 py-1.5 rounded-lg bg-yellow-50 text-yellow-700 border border-yellow-200 hover:bg-yellow-100 transition-colors text-sm font-bold" data-action="away-timeout">
                  + T/O
                </button>
                <button class="px-3 py-1.5 rounded-lg bg-gray-50 text-gray-500 border border-gray-200 hover:bg-gray-100 transition-colors text-sm font-bold" data-action="reset-away-timeouts">
                  <%= t('scoreboards.control.score_reset', default: 'Reset') %>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile: Possession & Swap (모바일에서만 보임) -->
      <div class="lg:hidden flex items-center justify-center py-2">
        <div class="bg-white rounded-full shadow-lg border border-gray-200 py-2 px-3 flex items-center gap-2">
          <button class="size-9 rounded-full flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-400 transition-colors" data-action="set-possession-left">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
            </svg>
          </button>
          <div class="flex items-center gap-1 px-1">
            <svg width="20" height="16" viewBox="0 0 24 24" class="possession-arrow-left hidden fill-red-500">
              <polygon points="0,12 18,0 18,8 24,8 24,16 18,16 18,24" />
            </svg>
            <span class="text-xs font-bold text-gray-500 tracking-wide"><%= t('scoreboards.control.possession_direction') %></span>
            <svg width="20" height="16" viewBox="0 0 24 24" class="possession-arrow-right hidden fill-blue-500">
              <polygon points="24,12 6,0 6,8 0,8 0,16 6,16 6,24" />
            </svg>
          </div>
          <button class="size-9 rounded-full flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-400 transition-colors" data-action="set-possession-right">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/>
            </svg>
          </button>
          <div class="h-6 w-px bg-gray-200 mx-1"></div>
          <button class="h-9 px-3 rounded-full flex items-center justify-center gap-1.5 bg-purple-100 hover:bg-purple-200 text-purple-600 transition-colors group"
                  data-action="swap-sides" title="<%= t('scoreboards.control.swap_scores') %>">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-4 group-hover:rotate-180 transition-transform duration-300" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/>
            </svg>
            <span class="text-xs font-bold tracking-wide"><%= t('scoreboards.control.swap_short') %></span>
          </button>
          <button class="h-9 px-3 rounded-full flex items-center justify-center gap-1.5 bg-teal-500 hover:bg-teal-600 text-white transition-colors"
                  data-action="toggle-possession">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"/>
            </svg>
            <span class="text-xs font-bold tracking-wide"><%= t('scoreboards.control.switch_short') %></span>
          </button>
        </div>
      </div>

      <!-- Quick Actions & Controls -->
      <div class="bg-white rounded-2xl p-6 shadow-[0_10px_15px_-3px_rgba(0,0,0,0.05),0_4px_6px_-2px_rgba(0,0,0,0.025)] border border-gray-100">
        <div class="flex items-center gap-2 mb-6 border-b border-gray-100 pb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"/>
          </svg>
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-widest"><%= t('scoreboards.control.control_center') %></h3>
        </div>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <button class="flex flex-col items-center justify-center gap-2 p-4 rounded-xl border border-gray-200 bg-gray-50 hover:bg-white hover:shadow-md transition-all group"
                  data-action="buzzer" data-ui-key="buzzer_label">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-6 text-red-500 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
            <span class="text-sm font-bold text-gray-700"><%= t('scoreboards.control.buzzer') %></span>
          </button>
          <button class="flex flex-col items-center justify-center gap-2 p-4 rounded-xl border border-blue-200 bg-blue-50 hover:bg-blue-100 transition-all group voice-toggle-btn"
                  data-action="toggle-announcements-btn"
                  data-voice-enabled="true">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-6 text-blue-500 group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="currentColor" data-voice-icon>
              <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
            </svg>
            <div class="flex items-center gap-2">
              <span class="text-sm font-bold text-blue-700" data-voice-label>음성안내</span>
              <span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-blue-500 text-white" data-voice-status>ON</span>
            </div>
            <input type="checkbox" checked class="hidden" data-action="toggle-announcements" />
          </button>
          <% unless @match.id.to_s.start_with?("standalone_") %>
            <button class="flex flex-col items-center justify-center gap-2 p-4 rounded-xl border border-amber-200 bg-amber-50 hover:bg-amber-100 text-amber-600 transition-all font-bold group"
                    data-action="save-and-pause"
                    data-ui-key="save_and_pause">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-6" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
              </svg>
              <span class="text-sm"><%= t('scoreboards.control.save_and_pause') %></span>
            </button>
            <button class="flex flex-col items-center justify-center gap-2 p-4 rounded-xl border border-[#FF6B35] bg-gradient-to-br from-[#FF6B35] to-[#E55A2B] text-white hover:shadow-lg hover:shadow-orange-500/25 transition-all font-bold group"
                    data-action="next-quarter"
                    data-ui-key="next_quarter"
                    data-next-quarter-btn
                    data-finish-text="<%= t('matches.finish_label', default: '경기 종료') %>"
                    data-next-text="<%= t('matches.next_quarter_label', default: '다음 쿼터') %>">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-6 group-hover:translate-x-1 transition-transform" viewBox="0 0 24 24" fill="currentColor" data-next-quarter-icon>
                <path d="M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"/>
              </svg>
              <span class="text-sm" data-next-quarter-title><%= t('matches.next_quarter_label', default: '다음 쿼터') %></span>
            </button>
          <% end %>
        </div>
      </div>

      <!-- Draggable Sections Container -->
      <div id="draggable-sections-container" class="space-y-6">
        <% unless @match.id.to_s.start_with?("standalone_") %>
          <!-- Score Table -->
          <div class="bg-white rounded-2xl border border-gray-100 overflow-hidden shadow-[0_10px_15px_-3px_rgba(0,0,0,0.05),0_4px_6px_-2px_rgba(0,0,0,0.025)] draggable-section" id="score-table-section" draggable="true" data-section-id="score-table">
            <div class="p-4 bg-gray-50/50 flex items-center justify-between cursor-pointer hover:bg-gray-100/50 transition-colors"
                 data-action="toggle-score-table"
                 data-toggle-section="score-table">
              <div class="flex items-center gap-2">
                <span class="drag-handle cursor-grab active:cursor-grabbing text-gray-300 hover:text-gray-500 mr-1" title="<%= t('scoreboards.control.drag_to_reorder') %>">
                  <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                  </svg>
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-gray-400" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M3 3v18h18V3H3zm8 16H5v-6h6v6zm0-8H5V5h6v6zm8 8h-6v-6h6v6zm0-8h-6V5h6v6z"/>
                </svg>
                <span class="font-bold text-gray-700" data-ui-key="quarter_table_matchup">경기별 쿼터 점수</span>
              </div>
            <div class="flex items-center gap-2">
              <button type="button"
                      class="px-3 py-1 rounded-lg bg-gray-900 text-white text-xs font-bold transition-colors"
                      data-action="set-quarter-view-cumulative"
                      data-ui-key="view_cumulative">
                누적
              </button>
              <button type="button"
                      class="px-3 py-1 rounded-lg bg-white text-gray-500 hover:bg-gray-100 text-xs font-bold transition-colors"
                      data-action="set-quarter-view-per-quarter"
                      data-ui-key="view_per_quarter">
                쿼터별
              </button>
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5 text-gray-400 transition-transform" id="score-table-toggle-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"/>
              </svg>
            </div>
          </div>
          <div id="score-table-content" class="border-t border-gray-100" data-quarter-table>
            <!-- Table injected by JS -->
          </div>
          </div>
        <% end %>

        <%= render "scoreboards/keyboard_shortcuts" %>
      </div>
      <!-- End Draggable Sections Container -->
    </main>
  </div>
</div>


<style>
  .draggable-section {
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  .draggable-section:hover .drag-handle {
    opacity: 1;
  }
  .drag-handle {
    opacity: 0.5;
    transition: opacity 0.15s ease, color 0.15s ease;
  }
  .draggable-section[draggable="true"]:active {
    cursor: grabbing;
  }
</style>
