<% content_for :title, t('admin.dashboard.page_title', app_name: t('app.name')) %>

<div class="max-w-7xl mx-auto">
  <!-- ë’¤ë¡œê°€ê¸° -->
  <div class="mb-4">
    <%= link_to clubs_path, class: "btn btn-ghost btn-sm gap-2" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      <%= t('admin.common.back_to_clubs') %>
    <% end %>
  </div>

  <!-- íŽ˜ì´ì§€ í—¤ë” -->
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-base-content mb-2"><%= t('admin.dashboard.title') %></h1>
    <p class="text-base-content/60"><%= t('admin.dashboard.subtitle') %></p>
  </div>

  <!-- í†µê³„ ê·¸ë¦¬ë“œ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="stats shadow bg-base-100">
      <div class="stat">
        <div class="stat-title"><%= t('admin.dashboard.stats.users') %></div>
        <div class="stat-value text-primary"><%= @stats[:users] %></div>
        <div class="stat-desc"><%= t('admin.common.count_unit') %></div>
      </div>
    </div>

    <div class="stats shadow bg-base-100">
      <div class="stat">
        <div class="stat-title"><%= t('admin.dashboard.stats.clubs') %></div>
        <div class="stat-value text-secondary"><%= @stats[:clubs] %></div>
        <div class="stat-desc"><%= t('admin.common.clubs_unit') %></div>
      </div>
    </div>

    <div class="stats shadow bg-base-100">
      <div class="stat">
        <div class="stat-title"><%= t('admin.dashboard.stats.members') %></div>
        <div class="stat-value text-accent"><%= @stats[:members] %></div>
        <div class="stat-desc"><%= t('admin.common.count_unit') %></div>
      </div>
    </div>

    <div class="stats shadow bg-base-100">
      <div class="stat">
        <div class="stat-title"><%= t('admin.dashboard.stats.matches') %></div>
        <div class="stat-value"><%= @stats[:matches] %></div>
        <div class="stat-desc"><%= t('admin.common.matches_unit') %></div>
      </div>
    </div>
  </div>

  <!-- DB ëŒ€ì‹œë³´ë“œ -->
  <div class="card-modern-static mb-8">
    <div class="card-body">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
        <div>
          <h2 class="card-title"><%= t('admin.dashboard.db_dashboard.title') %></h2>
          <p class="text-sm text-base-content/60">
            <%= t('admin.dashboard.db_dashboard.adapter') %>: <span class="font-semibold"><%= @database_adapter %></span>
            <% if @database_name.present? %>
              Â· <%= t('admin.dashboard.db_dashboard.db_name') %>: <span class="font-mono"><%= @database_name %></span>
            <% end %>
          </p>
        </div>
        <div class="stats stats-horizontal shadow bg-base-200/60">
          <div class="stat py-2 px-4">
            <div class="stat-title text-xs"><%= t('admin.dashboard.db_dashboard.table_count') %></div>
            <div class="stat-value text-2xl"><%= @db_tables.size %></div>
          </div>
          <div class="stat py-2 px-4">
            <div class="stat-title text-xs"><%= t('admin.dashboard.db_dashboard.preview_rows') %></div>
            <div class="stat-value text-2xl"><%= @selected_rows.size %></div>
          </div>
        </div>
      </div>

      <% if @db_tables.any? %>
        <div class="mb-4">
          <div class="text-xs font-bold uppercase tracking-widest opacity-50 mb-2"><%= t('admin.dashboard.db_dashboard.row_count_by_table') %></div>
          <div class="flex flex-wrap gap-2">
            <% @table_counts.each do |table_name, row_count| %>
              <% active = table_name == @selected_table %>
              <%= link_to admin_root_path(table: table_name, limit: @selected_limit),
                  class: "badge badge-lg #{active ? 'badge-primary' : 'badge-outline'} gap-2" do %>
                <span><%= table_name %></span>
                <span class="font-bold"><%= row_count %></span>
              <% end %>
            <% end %>
          </div>
        </div>

        <%= form_with url: admin_root_path, method: :get, local: true, class: "flex flex-wrap items-end gap-3 mb-4" do %>
          <div class="form-control min-w-[220px]">
            <label class="label pb-1">
              <span class="label-text text-xs font-bold uppercase tracking-widest opacity-60"><%= t('admin.dashboard.db_dashboard.select_table') %></span>
            </label>
            <%= select_tag :table,
                options_for_select(@db_tables, @selected_table),
                class: "select select-bordered select-sm" %>
          </div>

          <div class="form-control w-28">
            <label class="label pb-1">
              <span class="label-text text-xs font-bold uppercase tracking-widest opacity-60"><%= t('admin.dashboard.db_dashboard.row_limit') %></span>
            </label>
            <%= number_field_tag :limit, @selected_limit, min: 10, max: 200, class: "input input-bordered input-sm" %>
          </div>

          <%= submit_tag t('admin.dashboard.db_dashboard.query'), class: "btn btn-primary btn-sm" %>
        <% end %>

        <% admin_links = {
          "users" => admin_users_path,
          "clubs" => admin_clubs_path,
          "members" => admin_members_path,
          "matches" => admin_matches_path,
          "teams" => admin_teams_path,
          "team_members" => admin_team_members_path,
          "games" => admin_games_path
        } %>

        <div class="flex items-center justify-between mb-2">
          <h3 class="font-bold">
            <%= t('admin.common.recent_items', table: @selected_table, limit: @selected_limit) %>
          </h3>
          <% if admin_links[@selected_table].present? %>
            <%= link_to t('admin.common.view_all_list'), admin_links[@selected_table], class: "btn btn-ghost btn-xs" %>
          <% end %>
        </div>

        <div class="overflow-x-auto border border-base-300 rounded-box">
          <table class="table table-sm">
            <thead>
              <tr>
                <% @selected_columns.each do |column_name| %>
                  <th class="whitespace-nowrap"><%= column_name %></th>
                <% end %>
              </tr>
            </thead>
            <tbody>
              <% if @selected_rows.any? %>
                <% @selected_rows.each do |row| %>
                  <tr>
                    <% @selected_columns.each do |column_name| %>
                      <% value = row[column_name] %>
                      <% rendered = case value
                        when Hash, Array then value.to_json
                        when NilClass then "-"
                        else value.to_s
                      end %>
                      <td class="max-w-[260px]">
                        <div class="truncate" title="<%= rendered %>"><%= rendered %></div>
                      </td>
                    <% end %>
                  </tr>
                <% end %>
              <% else %>
                <tr>
                  <td colspan="<%= @selected_columns.size %>" class="text-center py-8 text-base-content/50">
                    <%= t('admin.common.no_data') %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert">
          <span><%= t('admin.common.no_tables') %></span>
        </div>
      <% end %>
    </div>
  </div>

  <!-- ìƒì„¸ ë°ì´í„° ê´€ë¦¬ ì¹´ë“œ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% [
      { name: t('admin.dashboard.stats.users'), count: @stats[:users], path: admin_users_path, icon: "ðŸ‘¤" },
      { name: t('admin.dashboard.stats.clubs'), count: @stats[:clubs], path: admin_clubs_path, icon: "ðŸ€" },
      { name: t('admin.dashboard.stats.members'), count: @stats[:members], path: admin_members_path, icon: "ðŸ‘¥" },
      { name: t('admin.dashboard.stats.matches'), count: @stats[:matches], path: admin_matches_path, icon: "ðŸ†" },
      { name: t('admin.dashboard.stats.teams'), count: @stats[:teams], path: admin_teams_path, icon: "ðŸ‘•" },
      { name: t('admin.dashboard.stats.games'), count: @stats[:games], path: admin_games_path, icon: "ðŸŽ®" }
    ].each do |item| %>
      <div class="card-modern">
        <div class="card-body items-center text-center">
          <div class="text-4xl mb-2"><%= item[:icon] %></div>
          <h2 class="card-title"><%= item[:name] %> <%= t('admin.common.manage') %></h2>
          <p class="text-base-content/60"><%= t('admin.common.total_count', count: item[:count]) %></p>
          <div class="card-actions mt-4">
            <%= link_to t('admin.common.details'), item[:path], class: "btn btn-primary btn-sm" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
