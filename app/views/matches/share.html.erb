<div class="max-w-7xl w-full">
  <!-- Header -->
  <div class="flex flex-col items-start justify-start mb-12">
    <h1 class="font-black text-gray-900 text-5xl leading-tight mb-3 tracking-tight"><%= @club.name %></h1>
    <div class="flex items-center gap-3 text-gray-500">
      <span class="font-mono text-base font-bold tracking-widest text-blue-600 bg-blue-50 px-2 py-1 rounded"><%= @match.played_on.strftime("%Y.%m.%d") %></span>
      <% if @match.note.present? %>
        <span class="w-1 h-1 rounded-full bg-gray-300"></span>
        <span class="text-base font-medium text-gray-600"><%= @match.note %></span>
      <% end %>
    </div>
  </div>

  <!-- Capture Target Area -->
  <div id="capture-area" class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200">
    <!-- Result Card -->
    <div class="bg-gray-100 p-8 relative overflow-hidden">
      <!-- Team Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-<%= @teams.size %> gap-6 relative z-10">
        <% @teams.each do |team| %>
          <%
             # Calculate statistics for this team
             wins = 0
             draws = 0
             losses = 0
             
             @games.each do |g|
               if g.home_team_id == team.id
                 if g.result == 'home_win'
                   wins += 1
                 elsif g.result == 'away_win'
                   losses += 1
                 elsif g.result == 'draw'
                   draws += 1
                 end
               elsif g.away_team_id == team.id
                 if g.result == 'away_win'
                   wins += 1
                 elsif g.result == 'home_win'
                   losses += 1
                 elsif g.result == 'draw'
                   draws += 1
                 end
               end
             end
          %>
          
          <!-- Team Card -->
          <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col h-full border-t-8" style="border-color: <%= team.color %>">
            
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-black italic tracking-tight text-gray-900">TEAM <%= team.label %></h2>
              <% 
                 is_bright = ['white', '#ffffff', '#fff', 'yellow'].include?(team.color.downcase)
                 badge_text = is_bright ? 'text-gray-900 border border-gray-200' : 'text-white'
              %>
              <span class="px-3 py-1 rounded-full text-xs font-bold shadow-sm <%= badge_text %>" style="background-color: <%= team.color %>">
                <%= team.color.upcase %>
              </span>
            </div>
            
            <!-- Stats -->
            <div class="bg-gray-50 rounded-xl p-4 mb-6 grid grid-cols-3 divide-x divide-gray-200">
              <div class="text-center">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">WINS</div>
                <div class="text-3xl font-black text-green-500"><%= wins %></div>
              </div>
              <div class="text-center">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">DRAWS</div>
                <div class="text-3xl font-black text-gray-700"><%= draws %></div>
              </div>
              <div class="text-center">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">LOSSES</div>
                <div class="text-3xl font-black text-red-500"><%= losses %></div>
              </div>
            </div>
            
            <!-- Members -->
            <div class="flex-1">
              <div class="grid grid-cols-2 gap-x-4 gap-y-3">
                <% team.members.each do |member| %>
                  <div class="flex items-center justify-between p-2 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors">
                    <span class="font-bold text-gray-800 text-sm"><%= member.name %></span>
                    
                    <% 
                       pos_color = case member.position
                                   when 'PG' then 'bg-blue-100 text-blue-700'
                                   when 'SG' then 'bg-indigo-100 text-indigo-700'
                                   when 'SF' then 'bg-green-100 text-green-700'
                                   when 'PF' then 'bg-orange-100 text-orange-700'
                                   when 'C' then 'bg-red-100 text-red-700'
                                   else 'bg-gray-200 text-gray-600'
                                   end
                    %>
                    <span class="text-[10px] font-black px-2 py-0.5 rounded <%= pos_color %>"><%= member.position %></span>
                  </div>
                <% end %>
              </div>
            </div>
            
          </div>
        <% end %>
      </div>
    </div>

    <!-- Match Logs (Quarters) -->
    <div class="bg-slate-900 p-6 text-white">
      <h3 class="text-xs font-bold text-white/40 uppercase tracking-widest mb-6">GAME SCOREBOARD</h3>
      <div class="flex flex-col gap-6">
        <% @games.each_with_index do |game, index| %>
          <div class="group bg-black/40 rounded-xl p-5 ring-1 ring-white/10">
            <!-- Game Header -->
            <div class="flex items-center justify-between mb-4 border-b border-white/5 pb-2">
              <div class="bg-primary/20 text-primary text-[10px] font-black px-2 py-1 rounded tracking-widest">
                GAME <%= index + 1 %>
              </div>
              <div class="text-[10px] font-bold text-white/20 uppercase tracking-widest">
                Match Result
              </div>
            </div>

            <div class="flex flex-col gap-6 pt-2">
              <!-- 상단: 점수판 메인 -->
              <div class="grid grid-cols-[1fr_auto_1fr] items-center gap-4 px-2 relative">
                
                <!-- 홈팀 정보 -->
                <div class="flex flex-col items-start min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <div class="w-1.5 h-8 rounded-sm" style="background-color: <%= game.home_team.color %>"></div>
                    <span class="text-xs md:text-sm font-bold text-white/40 tracking-[0.2em]">HOME</span>
                  </div>
                  <div class="text-2xl md:text-4xl font-black italic text-slate-100 truncate w-full leading-none"><%= game.home_team.label %></div>
                </div>

                <!-- 중앙 점수 -->
                <div class="flex items-center justify-center gap-6 md:gap-12">
                   <div class="text-[4rem] md:text-[6rem] font-black font-mono leading-none tracking-tighter text-slate-100 <%= 'text-yellow-400 drop-shadow-[0_0_30px_rgba(250,204,21,0.4)]' if game.home_score > game.away_score %>">
                     <%= game.home_score %>
                   </div>

                   <div class="flex flex-col items-center justify-center gap-1 opacity-60 pb-2">
                     <% if game.home_score > game.away_score %>
                       <div class="flex items-center gap-2">
                         <span class="text-[0.6rem] font-black text-success tracking-widest uppercase">WIN</span>
                         <div class="w-px h-3 bg-white/20"></div>
                         <span class="text-[0.6rem] font-bold text-white/20 tracking-widest uppercase">LOSE</span>
                       </div>
                     <% elsif game.away_score > game.home_score %>
                       <div class="flex items-center gap-2">
                         <span class="text-[0.6rem] font-bold text-white/20 tracking-widest uppercase">LOSE</span>
                         <div class="w-px h-3 bg-white/20"></div>
                         <span class="text-[0.6rem] font-black text-success tracking-widest uppercase">WIN</span>
                       </div>
                     <% elsif game.home_score == game.away_score && game.result != "pending" %>
                       <div class="flex items-center gap-2">
                         <span class="text-[0.6rem] font-bold text-warning tracking-widest uppercase">DRAW</span>
                         <div class="w-px h-3 bg-white/20"></div>
                         <span class="text-[0.6rem] font-bold text-warning tracking-widest uppercase">DRAW</span>
                       </div>
                     <% else %>
                       <span class="text-xl font-black italic text-white/20">VS</span>
                     <% end %>
                   </div>

                   <div class="text-[4rem] md:text-[6rem] font-black font-mono leading-none tracking-tighter text-slate-100 <%= 'text-yellow-400 drop-shadow-[0_0_30px_rgba(250,204,21,0.4)]' if game.away_score > game.home_score %>">
                     <%= game.away_score %>
                   </div>
                </div>

                <!-- 어웨이팀 정보 -->
                <div class="flex flex-col items-end min-w-0">
                  <div class="flex items-center gap-2 mb-1 justify-end">
                    <span class="text-xs md:text-sm font-bold text-white/40 tracking-[0.2em]">AWAY</span>
                    <div class="w-1.5 h-8 rounded-sm" style="background-color: <%= game.away_team.color %>"></div>
                  </div>
                  <div class="text-2xl md:text-4xl font-black italic text-slate-100 truncate w-full text-right leading-none"><%= game.away_team.label %></div>
                </div>
              </div>

              <!-- 하단: 박스스코어 (Classic Grid) -->
              <div class="bg-black/20 rounded-lg p-3 md:p-4 border border-white/5">
                <div class="grid grid-cols-[100px_1fr_1fr_1fr_1fr_1fr] gap-y-2 text-center items-center">
                  <!-- Header -->
                  <div class="text-left text-xs font-bold text-white/20 pl-2">TEAM</div>
                  <div class="text-xs font-bold text-white/20">1Q</div>
                  <div class="text-xs font-bold text-white/20">2Q</div>
                  <div class="text-xs font-bold text-white/20">3Q</div>
                  <div class="text-xs font-bold text-white/20">4Q</div>
                  <div class="text-xs font-bold text-white/40">TOT</div>

                  <!-- Divider -->
                  <div class="col-span-6 h-px bg-white/5 my-1"></div>

                  <!-- Home Row -->
                  <div class="text-left font-bold text-slate-100 truncate pl-2 flex items-center gap-2">
                    <div class="w-1 h-3 rounded-full" style="background-color: <%= game.home_team.color %>"></div>
                    <%= game.home_team.label %>
                  </div>
                  <% (1..4).each do |q| %>
                    <div class="font-mono text-lg md:text-xl font-bold <%= 'text-yellow-400' if (game.quarter_scores&.dig(q.to_s, "home") || 0) > (game.quarter_scores&.dig(q.to_s, "away") || 0) %>">
                      <%= game.quarter_scores&.dig(q.to_s, "home") || 0 %>
                    </div>
                  <% end %>
                  <div class="font-mono text-lg md:text-xl font-black text-white/60"><%= game.home_score %></div>

                  <!-- Away Row -->
                  <div class="text-left font-bold text-slate-100 truncate pl-2 flex items-center gap-2">
                     <div class="w-1 h-3 rounded-full" style="background-color: <%= game.away_team.color %>"></div>
                     <%= game.away_team.label %>
                  </div>
                  <% (1..4).each do |q| %>
                    <div class="font-mono text-lg md:text-xl font-bold <%= 'text-yellow-400' if (game.quarter_scores&.dig(q.to_s, "away") || 0) > (game.quarter_scores&.dig(q.to_s, "home") || 0) %>">
                      <%= game.quarter_scores&.dig(q.to_s, "away") || 0 %>
                    </div>
                  <% end %>
                  <div class="font-mono text-lg md:text-xl font-black text-white/60"><%= game.away_score %></div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <div class="mt-6 flex items-center justify-between text-xs text-gray-400 border-t border-gray-200 pt-4">
        <span>Basketball Club Manager</span>
        <span>generated by BM Rail</span>
      </div>
    </div>
  </div>
</div>
<!-- Refreshed: <%= Time.current %> -->
