<div class="max-w-5xl w-full">
  <!-- Header -->
  <div class="flex flex-col items-start justify-start mb-12">
    <h1 class="font-black text-gray-900 text-5xl leading-tight mb-3 tracking-tight"><%= @club.name %></h1>
    <div class="flex items-center gap-3 text-gray-500">
      <span class="font-mono text-base font-bold tracking-widest text-blue-600 bg-blue-50 px-2 py-1 rounded"><%= @match.played_on.strftime("%Y.%m.%d") %></span>
      <% if @match.note.present? %>
        <span class="w-1 h-1 rounded-full bg-gray-300"></span>
        <span class="text-base font-medium text-gray-600"><%= @match.note %></span>
      <% end %>
    </div>
  </div>

  <!-- Capture Target Area -->
  <div id="capture-area" class="bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200">
    <!-- Result Card -->
    <div class="bg-gray-100 p-8 relative overflow-hidden">
      <!-- Team Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-<%= @teams.size %> gap-6 relative z-10">
        <% @teams.each do |team| %>
          <%
             # Calculate statistics for this team
             wins = 0
             draws = 0
             losses = 0
             
             @games.each do |g|
               if g.home_team_id == team.id
                 if g.result == 'home_win'
                   wins += 1
                 elsif g.result == 'away_win'
                   losses += 1
                 elsif g.result == 'draw'
                   draws += 1
                 end
               elsif g.away_team_id == team.id
                 if g.result == 'away_win'
                   wins += 1
                 elsif g.result == 'home_win'
                   losses += 1
                 elsif g.result == 'draw'
                   draws += 1
                 end
               end
             end
          %>
          
          <!-- Team Card -->
          <div class="bg-white rounded-2xl shadow-lg p-6 flex flex-col h-full border-t-8" style="border-color: <%= team.color %>">
            
            <!-- Header -->
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-black italic tracking-tight text-gray-900">TEAM <%= team.label %></h2>
              <% 
                 is_bright = ['white', '#ffffff', '#fff', 'yellow'].include?(team.color.downcase)
                 badge_text = is_bright ? 'text-gray-900 border border-gray-200' : 'text-white'
              %>
              <span class="px-3 py-1 rounded-full text-xs font-bold shadow-sm <%= badge_text %>" style="background-color: <%= team.color %>">
                <%= team.color.upcase %>
              </span>
            </div>
            
            <!-- Stats -->
            <div class="bg-gray-50 rounded-xl p-4 mb-6 grid grid-cols-3 divide-x divide-gray-200">
              <div class="text-center">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">WINS</div>
                <div class="text-3xl font-black text-green-500"><%= wins %></div>
              </div>
              <div class="text-center">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">DRAWS</div>
                <div class="text-3xl font-black text-gray-700"><%= draws %></div>
              </div>
              <div class="text-center">
                <div class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">LOSSES</div>
                <div class="text-3xl font-black text-red-500"><%= losses %></div>
              </div>
            </div>
            
            <!-- Members -->
            <div class="flex-1">
              <div class="grid grid-cols-2 gap-x-4 gap-y-3">
                <% team.members.each do |member| %>
                  <div class="flex items-center justify-between p-2 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors">
                    <span class="font-bold text-gray-800 text-sm"><%= member.name %></span>
                    
                    <% 
                       pos_color = case member.position
                                   when 'PG' then 'bg-blue-100 text-blue-700'
                                   when 'SG' then 'bg-indigo-100 text-indigo-700'
                                   when 'SF' then 'bg-green-100 text-green-700'
                                   when 'PF' then 'bg-orange-100 text-orange-700'
                                   when 'C' then 'bg-red-100 text-red-700'
                                   else 'bg-gray-200 text-gray-600'
                                   end
                    %>
                    <span class="text-[10px] font-black px-2 py-0.5 rounded <%= pos_color %>"><%= member.position %></span>
                  </div>
                <% end %>
              </div>
            </div>
            
          </div>
        <% end %>
      </div>
    </div>

    <!-- Match Logs (Quarters) -->
    <div class="bg-gray-50 p-6">
      <h3 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">MATCH LOGS</h3>
      <div class="space-y-2">
        <% @games.each_with_index do |game, idx| %>
          <div class="bg-white p-4 rounded-lg border border-gray-100 shadow-sm">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-bold text-gray-400 bg-gray-100 px-2 py-1 rounded">GAME <%= idx + 1 %></span>
            </div>
            
            <table class="w-full text-center text-sm">
              <thead>
                <tr class="text-gray-400 text-xs border-b border-gray-100">
                  <th class="pb-1 text-left">Q</th>
                  <th class="pb-1 w-8">1</th>
                  <th class="pb-1 w-8">2</th>
                  <th class="pb-1 w-8">3</th>
                  <th class="pb-1 w-8">4</th>
                  <th class="pb-1 w-10 font-bold text-gray-600">Total</th>
                </tr>
              </thead>
              <tbody class="font-mono">
                <!-- Home Team Row -->
                <tr class="h-8">
                  <td class="text-left font-bold text-gray-900 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full" style="background-color: <%= game.home_team.color %>"></span>
                    <%= game.home_team.label %>
                  </td>
                  <% 
                    q_scores = game.quarter_scores || {} 
                    total_h = 0
                    (1..4).each do |q| 
                      s = (q_scores[q.to_s] || {})["home"].to_i
                      total_h += s
                  %>
                    <td class="text-gray-600"><%= s %></td>
                  <% end %>
                  <td class="font-bold text-gray-900"><%= game.home_score %></td>
                </tr>
                
                <!-- Away Team Row -->
                <tr class="h-8 border-t border-gray-50">
                  <td class="text-left font-bold text-gray-900 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full" style="background-color: <%= game.away_team.color %>"></span>
                    <%= game.away_team.label %>
                  </td>
                  <% 
                    total_a = 0
                    (1..4).each do |q| 
                      s = (q_scores[q.to_s] || {})["away"].to_i
                      total_a += s
                  %>
                    <td class="text-gray-600"><%= s %></td>
                  <% end %>
                  <td class="font-bold text-gray-900"><%= game.away_score %></td>
                </tr>
              </tbody>
            </table>
          </div>
        <% end %>
      </div>
      
      <div class="mt-6 flex items-center justify-between text-xs text-gray-400 border-t border-gray-200 pt-4">
        <span>Basketball Club Manager</span>
        <span>generated by BM Rail</span>
      </div>
    </div>
  </div>
</div>
<!-- Refreshed: <%= Time.current %> -->
